generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id        Int      @id @default(autoincrement())
  firstName String?
  lastName  String?
  email     String   @unique
  hash      String
  role      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Log {
  id        Int      @id @default(autoincrement())
  method    String
  url       String
  status    Int
  duration  Int
  userName  String?
  userId    Int?
  userRole  String?
  ip        String?
  createdAt DateTime @default(now())
}

model User {
  id                  Int                  @id @default(autoincrement())
  email               String               @unique
  hash                String
  firstName           String?
  lastName            String?
  role                String?
  phoneCode           String?
  phoneNumber         String?
  isEmailVerified     Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  userCars            UserCars[]           @relation("UserToUserCars")
  passwordResetTokens PasswordResetToken[]
  emailVerifications  EmailVerification[]
  AllCarsList         AllCarsList[]        @relation("UserToAllCarsList")
  favorites           Favorite[]
  @@map("users")
}

model Favorite {
  id         Int          @id @default(autoincrement())
  userId     Int
  carId      Int
  createdAt  DateTime     @default(now())
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  car        AllCarsList  @relation(fields: [carId], references: [id], onDelete: Cascade)
  @@unique([userId, carId])
}

model UserCars {
  id               Int         @id @default(autoincrement())
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  brand            String?
  model            String?
  year             Int
  price            Int
  mileage          Int
  fuel             String?
  condition        String?
  color            String?
  viewcount        Int         @default(0)
  ban              String?
  location         String?
  engine           String?
  gearbox          String?
  description      String?
  features         String[]
  status           String?     @default("basic")
  premiumExpiresAt DateTime?
  SaleType         String?
  vinCode          String?
  images           Carimages[] @relation("UserCarImages")
  userId           Int
  user             User        @relation("UserToUserCars", fields: [userId], references: [id])
  allCarsListId    Int?        @unique
  allCar           AllCarsList?@relation("UserCarToAllCar", fields: [allCarsListId], references: [id], onDelete: Cascade)

  publicId          String?     @unique

  @@map("userJournal")
}

model AllCarsList {
  id             Int         @id @default(autoincrement())
  createdAt      DateTime    @default(now())
  brand          String?
  model          String?
  year           Int
  price          Int
  mileage        Int
  fuel           String?
  condition      String?
  color          String?
  ban            String?
  viewcount      Int         @default(0)
  location       String?
  engine         String?
  gearbox        String?
  description    String?
  features       String[]
  status         String?     @default("basic")
  premiumExpiresAt DateTime?
  SaleType       String?
  vinCode        String?
  images         Carimages[] @relation("AllCarImages")

  userCar        UserCars?   @relation("UserCarToAllCar")
  favorites      Favorite[]
  userId         Int?
  user           User?       @relation("UserToAllCarsList", fields: [userId], references: [id])

  publicId       String?     @unique

  @@map("allCarsList")
}

model Carimages {
  id        Int          @id @default(autoincrement())
  url       String
  order     Int      @default(0)
  allCarId  Int?
  allCar    AllCarsList? @relation("AllCarImages", fields: [allCarId], references: [id])
  userCarId Int?
  userCar   UserCars?    @relation("UserCarImages", fields: [userCarId], references: [id])

  @@map("carImages")
}

model PasswordResetToken {
  token     String   @id
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  expires   DateTime
  createdAt DateTime @default(now())
}

model EmailVerification {
  id        Int      @id @default(autoincrement())
  code      String
  expires   DateTime
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([userId])
  @@map("email_verifications")
}

model PushSubscription {
  id        Int      @id @default(autoincrement())
  endpoint  String   @unique
  keysJson  String
  userId    String?
  createdAt DateTime @default(now())
}
